# Парсер для Amazon Kindle Cloud Reader

Этот инструмент позволяет извлекать текст из книг в Amazon Kindle Cloud Reader. В связи с ограничениями Amazon и особенностями веб-браузеров, процесс извлечения включает как автоматические, так и ручные шаги.

## Требования

- Python 3.8 или выше
- Веб-браузер (Chrome или Firefox)
- Аккаунт Amazon с книгами в Kindle

## Установка

1. Клонируйте репозиторий:
   ```
   git clone https://github.com/yourusername/AmazonBookParser.git
   cd AmazonBookParser
   ```

2. Установите необходимые зависимости:
   ```
   pip install -r requirements.txt
   ```

## Использование

### Метод 1: Веб-интерфейс (полуавтоматический)

1. Запустите веб-сервер:
   ```
   python main.py
   ```

2. Откройте в браузере `http://127.0.0.1:5000/`

3. Заполните форму:
   - Email и пароль Amazon
   - URL книги или оставьте поле пустым для ручного выбора
   - Количество страниц для чтения
   - Название выходного файла
   - Время ожидания между страницами (в секундах)

4. Нажмите "Запустить скрапинг"

5. В открывшемся браузере:
   - Войдите в свой аккаунт Amazon
   - Перейдите в Kindle библиотеку
   - Выберите и откройте нужную книгу
   - Программа автоматически начнет извлечение текста

### Метод 2: Извлечение через анализ сетевых запросов (рекомендуемый)

Этот метод использует инструменты разработчика в браузере для перехвата API запросов от Kindle Cloud Reader:

1. Войдите в Kindle Cloud Reader:
   - Откройте [Kindle Cloud Reader](https://read.amazon.com/)
   - Войдите в свой аккаунт Amazon

2. Откройте инструменты разработчика:
   - Chrome: нажмите F12 или Ctrl+Shift+I
   - Firefox: нажмите F12 или щелкните правой кнопкой мыши и выберите "Инспектировать"

3. Перейдите на вкладку "Network" (Сеть):
   - Убедитесь, что запись сетевого трафика включена (красная точка должна быть активна)
   - Установите фильтр XHR для отображения только AJAX запросов

4. Откройте книгу и перелистайте несколько страниц:
   - В панели Network будут появляться запросы
   - Ищите запросы, содержащие в URL "getFileToken", "content" или "reader"

5. Сохраните ответы API:
   - Щелкните правой кнопкой мыши на нужном запросе
   - Выберите "Copy > Copy Response" или "Save Response As..."
   - Сохраните ответ в файл с расширением .json

6. Используйте новый скрипт для извлечения текста:
   ```python
   from kindle_api_scraper import KindleAPIScraper
   
   # Метод с файлом ответа API
   scraper = KindleAPIScraper(output_file="kindle_book.txt")
   scraper.run(response_file="saved_response.json")
   
   # ИЛИ
   
   # Метод с HAR файлом (полная запись сетевого трафика)
   # Для сохранения HAR: в панели Network нажмите правой кнопкой мыши и выберите "Save all as HAR"
   scraper.run(har_file="network_log.har")
   ```

7. Советы для этого метода:
   - Чем больше страниц вы пролистаете, тем больше текста будет доступно
   - Обратите внимание на структуру JSON ответов для корректного извлечения текста
   - При необходимости настройте код в файле `kindle_api_scraper.py` для правильного извлечения текста

### Метод 3: Ручное извлечение (если другие методы не работают)

1. Войдите в Kindle Cloud Reader:
   - Откройте [Kindle Cloud Reader](https://read.amazon.com/)
   - Войдите в свой аккаунт Amazon
   
2. Откройте книгу:
   - Выберите книгу из вашей библиотеки
   - Откройте книгу для чтения
   
3. Копирование текста (повторяйте для каждой страницы):
   - Щелкните правой кнопкой мыши на странице и выберите "Просмотреть код" или "Инспектировать элемент"
   - В открывшейся панели разработчика найдите элементы с классами `textLayer`, `kcrPage`, `bookReaderContainer`, или `kindleReaderPage`
   - Текст книги обычно находится внутри этих элементов
   - Скопируйте текст и вставьте в текстовый файл
   - Перейдите на следующую страницу с помощью клавиш со стрелками или кнопок навигации
   
4. Советы по извлечению текста:
   - Отключите интерфейс Kindle Reader, кликнув по центру страницы
   - Используйте клавишу Tab для навигации между элементами и выделения текста
   - Если текст не выделяется, попробуйте использовать инструменты разработчика для извлечения содержимого

### Метод 4: Использование скрипта напрямую

Вы также можете использовать скрипт напрямую из командной строки:

```python
from kindle_scraper import KindleScraper

scraper = KindleScraper(
    email="your_email@example.com",
    password="your_password",
    book_url="https://read.amazon.com/your_book_url",
    output_file="book_text.txt",
    pages_to_read=100,
    page_load_time=3
)

success = scraper.run()
if success:
    print(f"Книга успешно извлечена и сохранена в файл {scraper.output_file}")
else:
    print("Произошла ошибка при извлечении книги. Проверьте лог-файл для деталей.")
```

## Устранение неполадок

### Браузер не запускается
- Убедитесь, что у вас установлен Chrome или Firefox
- Проверьте, что для вашей версии браузера установлен соответствующий WebDriver
- Попробуйте запустить с другими настройками браузера

### Проблемы с авторизацией
- Проверьте правильность email и пароля
- Если у вас включена двухфакторная аутентификация, вам может потребоваться войти вручную

### Текст не извлекается
- Проверьте, что книга открыта в режиме чтения
- Попробуйте увеличить время ожидания между страницами
- Используйте метод ручного извлечения текста

## Примечание

Этот инструмент предназначен только для личного использования и для извлечения контента из книг, которые вы приобрели легально. Уважайте авторские права и условия использования Amazon Kindle.

## Поддержка

При возникновении проблем или вопросов, создайте issue в репозитории GitHub.